{
    "_id": "jO4Ipjz3BGo6ZzG9",
    "actorIds": [],
    "author": "lO8uxG8O9SiAPpi1",
    "command": "function CoverMacro() {\n    if (!actor) {\n        ui.notifications.warn(\"You must have an actor selected.\");\n        return;\n    };\n    activateCover()\n};\nasync function activateCover() {\n    let msgContent;\n    let CoverEffect = 'Compendium.pf2e.equipment-effects.I9lfZUiCwMiGogVi';\n    let takingCover = true;\n    let existing = token.actor.items.find(\n        (e) => e.type === 'effect' && e?.data?.flags?.core?.sourceId === CoverEffect,\n    );\n    if (existing) {\n        await token.actor.deleteEmbeddedDocuments('Item', [existing.id]);\n        msgContent = \"Clearing cover modifiers for \";\n        takingCover = false;\n    };\n\n    if (takingCover) {\n        msgContent = \"Granting cover to \";\n        const item = (await fromUuid(CoverEffect)).toObject();\n        await token.actor.createEmbeddedDocuments('Item', [item]);\n    };\n\n\n    msgContent = msgContent + actor.data.name\n    let chatData = {\n        user: game.user.id,\n        content: msgContent,\n        whisper: [game.user.id],\n    };\n    ChatMessage.create(chatData, {});\n}\n\nCoverMacro();",
    "flags": {},
    "img": "systems/pf2e/icons/actions/OneAction.webp",
    "name": "Take Cover",
    "permission": {
        "default": 0
    },
    "scope": "global",
    "type": "script"
}
