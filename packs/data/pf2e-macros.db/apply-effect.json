{
    "_id": "vWi8tnMZpqQnK68X",
    "actorIds": [],
    "author": "M6L6STuBiXTluEz7",
    "command": "let applyChanges = false;\nconst compendiumName=\"pf2e.spell-effects\";\nconst effectCompendium = game.packs.get(compendiumName);\nlet effectList=[];\n\nasync function getEffectList(){\n    if(effectList.length<=0){\n        let effects = await effectCompendium.getContent();\n        for(let count=0;count<effects.length;count++){\n            if(effects[count].name.indexOf('Spell Effect:')!=-1)\n                effectList.push({\"UUID\": \"Compendium.\"+compendiumName+\".\"+effects[count]._id,\"Name\": effects[count].name});\n        }\n    }\n    return effectList;\n}\nasync function optionList() {\n    let optionlist='';\n    const list=await getEffectList();\n    for(let count=0;count<list.length;count++){\n        optionlist+='<option value=\"' + count + '\">'+ list[count].Name + '</option>';\n    }\n    return optionlist;\n}\n\nasync function applyEffect(effectid)\n{\n    let effectItem=effectList[effectid];\n    \n    const item = await fromUuid(effectItem.UUID);\n    for (const token of canvas.tokens.controlled) {\n        let existing = token.actor.items.filter(i => i.type === item.type).find(e => e.name === item.name);\n        if (existing) {\n            await token.actor.deleteOwnedItem(existing._id);\n        } else {\n            let owneditemdata = await token.actor.createOwnedItem(item);\n            owneditemdata.data.start.value=game.time.worldTime;\n        }\n    }\n}\n\nnew Dialog({\n  title: `Apply Effect`,\n  content: `\n    <form>\n      <div class=\"form-group\">\n        <label>Effect:</label>\n        <select id=\"effectChoice\" name=\"effectChoice\">` + (await optionList()) + `\n        </select>\n      </div>\n    </form>\n    `,\n  buttons: {\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: `Apply Changes`,\n      callback: () => applyChanges = true\n    },\n    no: {\n      icon: \"<i class='fas fa-times'></i>\",\n      label: `Cancel Changes`\n    },\n  },\n  default: \"yes\",\n  close: html => {\n      if (applyChanges) {\n        let effectid = html.find('[name=\"effectChoice\"]')[0].value;\n        //console.log(effectItem);\n        applyEffect(effectid);\n\n    }\n  }\n}).render(true);",
    "flags": {},
    "img": "icons/svg/explosion.svg",
    "name": "Apply Effect",
    "permission": {
        "default": 0
    },
    "scope": "global",
    "type": "script"
}
